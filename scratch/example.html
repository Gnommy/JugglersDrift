<html>
<head><title>My Example</title></head>
<body>
<canvas id="cv" width="600" height="600">
<p>Your browser doesn't support the HTML5 &lt;canvas&gt; tag!</p>
</canvas>



<script type="text/javascript">
var BPM = 100; // 100 juggling beats per minute
var FPS = 10;  // 20 frames per second
var BPF = BPM / (60*FPS);  // fraction of a beat to advance, per frame

function interpolate(p, a, b) {
  return (1-p)*a + p*b;
}

function circle(ctx, x, y, radius) {
  ctx.strokeStyle = "#000000"; ctx.fillStyle = "#000000";
  ctx.beginPath(); ctx.arc(x, y, radius, 0, Math.PI*2, true);
  ctx.closePath(); ctx.stroke(); ctx.fill();
}

// Draw a juggler at (x,y) facing (fx,fy), with radius (r).
function juggler(ctx, x, y, fx, fy, r) {
  circle(ctx, x,y, r);
  var angle = Math.atan2(fy-y, fx-x);
  circle(ctx, x+r*Math.cos(angle-1.3), y+r*Math.sin(angle-1.3), r/2);
  circle(ctx, x+r*Math.cos(angle+1.3), y+r*Math.sin(angle+1.3), r/2);
}

var can = document.getElementById('cv');
var ctx;
if (can.getContext) {
  ctx = can.getContext('2d');
  setInterval("animate(ctx)", 1000/FPS);
} else {
  document.write('Something went wrong with Canvas!');
}

var JugglerSize = 20;
var Jugglers = [
  { name: 'Alice', ts: [0,  2,      6,  8,      12, ],
                    x: [110,110,    200,110,     20,],
                    y: [ 20, 20,     20, 70,    200,],
                   fx: [110,110,    110,110,    110,],
                   fy: [999,999,    200,200,     20,] },
  { name: 'Bob',   ts: [0,      4,  6,  8,      12, ],
                    x: [ 20,    110,110,110,    200,],
                    y: [200,    200,200,200,    200,],
                   fx: [110,    110,110,110,    110,],
                   fy: [ 20,     20,  0,  0,     20,] },
  { name: 'Carol', ts: [0,  2,      6,      10, 12, ],
                    x: [200,110,     20,    110,110,],
                    y: [200,150,     20,     20, 20,],
                   fx: [110,110,    110,    110,110,],
                   fy: [ 20, 20,    200,    200,999,] },
];
var PatternLengthInBeats = 12;

var timestep = 1;
function animate(ctx) {
  ctx.clearRect(0,0, can.width, can.height);

  timestep += BPF;
  if (timestep > PatternLengthInBeats)
    timestep -= PatternLengthInBeats;


  for (var j = 0; j < Jugglers.length; ++j) {
    // Figure out which timestep-arc we're on
    var jug = Jugglers[j];
    for (var i = 0; i < jug.ts.length-1; ++i) {
      if (jug.ts[i] <= timestep && timestep < jug.ts[i+1]) {
        // Draw this juggler at a position interpolated
        // between the two given facings.
        var ts_diff = jug.ts[i+1] - jug.ts[i];
        var p = (timestep - jug.ts[i]) / ts_diff;
        juggler(ctx,
                interpolate(p, jug.x[i], jug.x[i+1]),
                interpolate(p, jug.y[i], jug.y[i+1]),
                interpolate(p, jug.fx[i], jug.fx[i+1]),
                interpolate(p, jug.fy[i], jug.fy[i+1]),
                JugglerSize);
        break;
      }
    }
  }
  
}

</script>

</body>
</html>
