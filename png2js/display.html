<html>
<head><title>My Example</title></head>
<body>
<canvas id="cv" width="600" height="600">
<p>Your browser doesn't support the HTML5 &lt;canvas&gt; tag!</p>
</canvas>



<script type="text/javascript">
function interpolate(p, a, b) {
  return (1-p)*a + p*b;
}

function circle(ctx, x, y, radius) {
  ctx.strokeStyle = "#000000"; ctx.fillStyle = "#000000";
  ctx.beginPath(); ctx.arc(x, y, radius, 0, Math.PI*2, true);
  ctx.closePath(); ctx.stroke(); ctx.fill();
}

// Draw a juggler at (x,y) facing (fx,fy), with radius (r).
function juggler(ctx, x, y, fx, fy, r) {
  circle(ctx, x,y, r);
  var angle = Math.atan2(fy-y, fx-x);
  circle(ctx, x+r*Math.cos(angle-1.3), y+r*Math.sin(angle-1.3), r/2);
  circle(ctx, x+r*Math.cos(angle+1.3), y+r*Math.sin(angle+1.3), r/2);
}

// Draw a thrown club at (x,y), sized to match a juggler of radius (r).
function club(ctx, x, y, r) {
  circle(ctx, x,y, r/3);
}

var can = document.getElementById('cv');
var ctx;
if (can.getContext) {
  ctx = can.getContext('2d');
  setInterval("animate(ctx)", 1000/FPS);
} else {
  document.write('Something went wrong with Canvas!');
}

var BPM = 100; // 100 juggling beats per minute
var FPS = 10;  // 20 frames per second
</script>
<script type="text/javascript" src="pattern.js"></script>
<script type="text/javascript">
var BPF = BPM / (60*FPS);  // fraction of a beat to advance, per frame

for (var j in Jugglers) {
  Jugglers[j].pos_at = function(timestep) {
    for (var i = 0; i < this.ts.length-1; ++i) {
      if (this.ts[i] <= timestep && timestep < this.ts[i+1]) {
        // Interpolate between the two given positions.
        var ts_diff = this.ts[i+1] - this.ts[i];
        var p = (timestep - this.ts[i]) / ts_diff;
        return [interpolate(p, this.x[i], this.x[i+1]), interpolate(p, this.y[i], this.y[i+1])];
      }
    }
  };
  Jugglers[j].facing_at = function(timestep) {
    for (var i = 0; i < this.ts.length-1; ++i) {
      if (this.ts[i] <= timestep && timestep < this.ts[i+1]) {
        // Interpolate between the two given positions.
        var ts_diff = this.ts[i+1] - this.ts[i];
        var p = (timestep - this.ts[i]) / ts_diff;
        return [interpolate(p, this.fx[i], this.fx[i+1]), interpolate(p, this.fy[i], this.fy[i+1])];
      }
    }
  };
}


var timestep = 1;
function animate(ctx) {
  ctx.clearRect(0,0, can.width, can.height);

  timestep += BPF;
  if (timestep > PatternLengthInBeats)
    timestep -= PatternLengthInBeats;


  for (var j in Jugglers) {
    var jug = Jugglers[j];
    var [x,y] = jug.pos_at(timestep);
    var [fx,fy] = jug.facing_at(timestep);
    juggler(ctx, x,y, fx,fy, JugglerSize);
  }

  for (var p in Passes) {
    var pass = Passes[p];
    if (pass.start <= timestep && timestep <= pass.end) {
      // Draw this pass (i.e., this thrown club) at a position
      // interpolated between the given jugglers.
      var ts_diff = pass.end - pass.start;
      var p = (timestep - pass.start) / ts_diff;
      club(ctx,
           interpolate(p, Jugglers[pass.from].pos_at(pass.start)[0],
                          Jugglers[pass.to].pos_at(pass.end)[0]),
           interpolate(p, Jugglers[pass.from].pos_at(pass.start)[1],
                          Jugglers[pass.to].pos_at(pass.end)[1]),
           JugglerSize);
    }
  }
  
}

</script>

</body>
</html>
